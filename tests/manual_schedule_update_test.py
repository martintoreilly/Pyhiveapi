import os
from pyhiveapi import Hive, SMS_REQUIRED
import sys

script_dir = os.path.dirname(__file__)
module_root = os.path.join(script_dir, '..', 'secrets')
sys.path.append(module_root)
from hive_credentials import hive_credentials

session = Hive(username=hive_credentials["username"], password=hive_credentials["password"])
login = session.login()

if login.get("ChallengeName") == SMS_REQUIRED:
    code = input("Enter 2FA code: ")
    session.sms2FA(code, login)

session.startSession()
thermostat = session.deviceList["climate"][0]
schedule_1 = {"monday":[{"value":{"target":19},"start":450},{"value":{"target":17},"start":555},{"value":{"target":17},"start":810},{"value":{"target":19},"start":1080},{"value":{"target":18.5},"start":1320,"type":"HEATING","dayIndex":0,"eventIndex":4},{"value":{"target":17},"start":1425}],"tuesday":[{"value":{"target":19},"start":450},{"value":{"target":17},"start":555},{"value":{"target":17},"start":810},{"value":{"target":19},"start":1080},{"value":{"target":18.5},"start":1320},{"value":{"target":17},"start":1425}],"wednesday":[{"value":{"target":19},"start":450},{"value":{"target":17},"start":555},{"value":{"target":17},"start":810},{"value":{"target":19},"start":1080},{"value":{"target":18.5},"start":1320},{"value":{"target":17},"start":1425}],"thursday":[{"value":{"target":19},"start":450},{"value":{"target":17},"start":555},{"value":{"target":17},"start":810},{"value":{"target":19},"start":1080},{"value":{"target":18.5},"start":1320},{"value":{"target":17},"start":1425}],"friday":[{"value":{"target":19},"start":450},{"value":{"target":17},"start":555},{"value":{"target":17},"start":810},{"value":{"target":19},"start":1080},{"value":{"target":18.5},"start":1320},{"value":{"target":17},"start":1425}],"saturday":[{"value":{"target":19},"start":450},{"value":{"target":17},"start":555},{"value":{"target":17},"start":810},{"value":{"target":19},"start":1080},{"value":{"target":18.5},"start":1320},{"value":{"target":17},"start":1425}],"sunday":[{"value":{"target":19},"start":450},{"value":{"target":17},"start":555},{"value":{"target":17},"start":810},{"value":{"target":19},"start":1080},{"value":{"target":18.5},"start":1320},{"value":{"target":17},"start":1425}]}
schedule_2 = {"monday":[{"value":{"target":20},"start":420},{"value":{"target":7},"start":540},{"value":{"target":7},"start":720},{"value":{"target":7},"start":840},{"value":{"target":20},"start":1200},{"value":{"target":7},"start":1320}],"tuesday":[{"value":{"target":20},"start":420},{"value":{"target":7},"start":540},{"value":{"target":7},"start":720},{"value":{"target":7},"start":840},{"value":{"target":20},"start":1200},{"value":{"target":7},"start":1320}],"wednesday":[{"value":{"target":20},"start":420},{"value":{"target":7},"start":540},{"value":{"target":7},"start":720},{"value":{"target":7},"start":840},{"value":{"target":20},"start":1200},{"value":{"target":7},"start":1320}],"thursday":[{"value":{"target":20},"start":420},{"value":{"target":7},"start":540},{"value":{"target":7},"start":720},{"value":{"target":7},"start":840},{"value":{"target":20},"start":1200},{"value":{"target":7},"start":1320}],"friday":[{"value":{"target":20},"start":420},{"value":{"target":7},"start":540},{"value":{"target":7},"start":720},{"value":{"target":7},"start":840},{"value":{"target":20},"start":1200},{"value":{"target":7},"start":1320}],"saturday":[{"value":{"target":20},"start":540},{"value":{"target":7},"start":660},{"value":{"target":7},"start":720},{"value":{"target":7},"start":840},{"value":{"target":20},"start":1200},{"value":{"target":7},"start":1320}],"sunday":[{"value":{"target":20},"start":540},{"value":{"target":7},"start":660},{"value":{"target":7},"start":720},{"value":{"target":7},"start":840},{"value":{"target":20},"start":1200},{"value":{"target":7},"start":1320}]}
schedule_3 = '{"monday":[{"value":{"target":21},"start":420},{"value":{"target":8},"start":540},{"value":{"target":8},"start":720},{"value":{"target":8},"start":840},{"value":{"target":21},"start":1200},{"value":{"target":8},"start":1320}],"tuesday":[{"value":{"target":21},"start":420},{"value":{"target":8},"start":540},{"value":{"target":8},"start":720},{"value":{"target":8},"start":840},{"value":{"target":21},"start":1200},{"value":{"target":8},"start":1320}],"wednesday":[{"value":{"target":21},"start":420},{"value":{"target":8},"start":540},{"value":{"target":8},"start":720},{"value":{"target":8},"start":840},{"value":{"target":21},"start":1200},{"value":{"target":8},"start":1320}],"thursday":[{"value":{"target":21},"start":420},{"value":{"target":8},"start":540},{"value":{"target":8},"start":720},{"value":{"target":8},"start":840},{"value":{"target":21},"start":1200},{"value":{"target":8},"start":1320}],"friday":[{"value":{"target":21},"start":420},{"value":{"target":8},"start":540},{"value":{"target":8},"start":720},{"value":{"target":8},"start":840},{"value":{"target":21},"start":1200},{"value":{"target":8},"start":1320}],"saturday":[{"value":{"target":21},"start":540},{"value":{"target":8},"start":660},{"value":{"target":8},"start":720},{"value":{"target":8},"start":840},{"value":{"target":21},"start":1200},{"value":{"target":8},"start":1320}],"sunday":[{"value":{"target":21},"start":540},{"value":{"target":8},"start":660},{"value":{"target":8},"start":720},{"value":{"target":8},"start":840},{"value":{"target":21},"start":1200},{"value":{"target":8},"start":1320}]}'

schedule_new = schedule_2
session.api.setState(thermostat["hiveType"],thermostat["hiveID"], schedule = schedule_new)
print(session.tokens.tokenData["token"])